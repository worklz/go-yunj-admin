layui.use(["jquery","yunj","elemProgress"],function(){let r=window;let l=document;let a=layui.jquery;let e=layui.elemProgress;class i{constructor(e){this.id=e.id;this.rawEl=e.elem;this.rawArgs=e.args;this.url=null;this.urlParam=null;this.isPopup=false;this.boxEl=null;this.tabBoxEl=null;this.buildNames=[];this.buildMap={};this._init().catch(e=>{yunj.error(e)})}async _init(){let t=this;if(!t.id||!t.rawArgs||yunj.isEmptyObj(t.rawArgs))throw new Error("表单构建器参数异常");await t._initData();let i=e({elem:t.boxEl});t.render().then(e=>{t.setEventBind();if(t.isSetTab())a(l).trigger(`yunj_form_${t.id}_tab_change`);i.reset_progress(100)})}rawArgsIsSetAttr(e){return this.rawArgs.hasOwnProperty(e)}isSetTab(){return this.rawArgsIsSetAttr("tab")}isSetField(){return this.rawArgsIsSetAttr("field")}isSetButton(){return this.rawArgsIsSetAttr("button")}async _initData(){let l=this;l.url=yunj.url(false);l.urlParam=yunj.urlParam(null,{});l.isPopup=l.urlParam.hasOwnProperty("isPopup")&&l.urlParam.isPopup==="yes";l.rawEl.after(`<div class="yunj-form-box" lay-filter="${l.id}">
                                    <div class="yunj-form-header">
                                        <div class="partition"></div>
                                            <div class="content">
                                                <h2>${yunj.currPageTitle(l.isPopup)}</h2>
                                            </div>
                                    </div>
                                    <div class="layui-tab" lay-filter="${l.id}_tab"></div>
                                </div>`);l.boxEl=a(`.yunj-form-box[lay-filter=${l.id}]`);l.tabBoxEl=l.boxEl.find(`.layui-tab[lay-filter=${l.id}_tab]`);let s=["tab","field","button"];for(let r=0,e=s.length;r<e;r++){let e=s[r].slice(0,1).toUpperCase()+s[r].slice(1);if(!l[`isSet${e}`]())continue;let t=`FormBuild${e}`;let i=await new Promise(e=>{layui.use(t,()=>{e(new layui[t](l))})});l.buildNames.push(i.buildName);l.buildMap[i.buildName]=i}}async render(){let i=this;for(let e=0,t=i.buildNames.length;e<t;e++){await i.buildMap[i.buildNames[e]].render()}a(l).trigger(`yunj_form_${i.id}_render_done`,[i])}setEventBind(){let i=this;for(let e=0,t=i.buildNames.length;e<t;e++){i.buildMap[i.buildNames[e]].setEventBind()}a(r).resize(function(){a(l).trigger(`yunj_form_${i.id}_win_resize`)})}getCurrTab(){return this.isSetTab()?this.buildMap.tab.getValue():undefined}getFieldObj(e){let t=this;let i=yunj.generateFormFieldId(t.id,e);if(t.buildMap.hasOwnProperty("field")&&t.buildMap.field.hasOwnProperty("fields")&&t.buildMap.field.fields.hasOwnProperty(i)){return t.buildMap.field.fields[i]}return null}}a(l).ready(function(){r.yunj.form={};let e=a("form[type=yunj]");if(yunj.isUndefined(YUNJ_FORM)||!yunj.isObj(YUNJ_FORM)||e.length<=0)return;e.each(function(){let e=a(this).attr("id");if(!YUNJ_FORM.hasOwnProperty(e))return true;let t=YUNJ_FORM[e];r.yunj.form[e]=new i({id:e,elem:a(this),args:t})})})});