layui.use(["jquery","yunj","elemProgress"],function(){let i=window;let l=document;let a=layui.jquery;let t=layui.elemProgress;class r{static RENDER_MODE={STATE_SWITCH:"STATE_SWITCH"};constructor(t){this.id=t.id;this.rawEl=t.elem;this.rawArgs=t.args;this.boxEl=null;this.url=null;this.buildNames=[];this.buildMap={};this._init().catch(t=>{yunj.error(t)})}async _init(){let e=this;if(!e.id||!e.rawArgs||yunj.isEmptyObj(e.rawArgs))throw new Error("表格构建器参数异常");await e._initData();let r=t({elem:e.boxEl});e.render().then(t=>{e.setEventBind();r.reset_progress(100)})}rawArgsIsSetAttr(t){return this.rawArgs.hasOwnProperty(t)}isSetState(){return this.rawArgsIsSetAttr("state")}isSetPage(){return this.rawArgsIsSetAttr("page")}isSetLimit(){return this.rawArgsIsSetAttr("limit")}isSetLimits(){return this.rawArgsIsSetAttr("limits")}isSetFilter(){return this.rawArgsIsSetAttr("filter")}isSetToolbar(){return this.rawArgsIsSetAttr("toolbar")}isSetDefaultToolbar(){return this.rawArgsIsSetAttr("defaultToolbar")}isSetTree(t=true){if(!this.rawArgsIsSetAttr("tree")){return false}if(t===false){return true}let e;if(yunj.isString(t)){e=t}else{if(!this.isSetState()){return true}e=this.getCurrState()}return this.rawArgs.tree.hasOwnProperty(e)&&this.rawArgs.tree[e]}isSetCols(){return this.rawArgsIsSetAttr("cols")}async _initData(){let s=this;s.rawEl.after(`<div class="yunj-table-box" lay-filter="${s.id}"></div>`);s.boxEl=a(`.yunj-table-box[lay-filter=${s.id}]`);s.url=yunj.url(false);let l=["state","filter","table"];for(let i=0,t=l.length;i<t;i++){let t=l[i].slice(0,1).toUpperCase()+l[i].slice(1);if(!s[`isSet${l[i]==="table"?"Cols":t}`]())continue;let e=`TableBuild${t}`;let r=await new Promise(t=>{layui.use(e,()=>{t(new layui[e](s))})});s.buildNames.push(r.buildName);s.buildMap[r.buildName]=r}}async render(r=""){let i=this;for(let t=0,e=i.buildNames.length;t<e;t++){await i.buildMap[i.buildNames[t]].render(r)}a(l).trigger(`yunj_table_${i.id}_render_done`)}setEventBind(){let r=this;for(let t=0,e=r.buildNames.length;t<e;t++){r.buildMap[r.buildNames[t]].setEventBind()}a(i).resize(function(){a(l).trigger(`yunj_table_${r.id}_doc_width_change`)})}getCurrState(){return this.isSetState()?this.buildMap.state.getValue():undefined}getCurrPk(){let e=this;let r="id";let t=e.rawArgs;if(!t.hasOwnProperty("pk")){return r}let i=t.pk;if(yunj.isString(i)){r=i}else{if(e.isSetState()){let t=e.getCurrState();if(i.hasOwnProperty(t)){r=i[t]}}}return r}getCurrPksKey(){let t=this;return t.getCurrPk()+"s"}getCurrRequestFilter(t={}){let e=this;let r={filter:true,convert:true,state:e.getCurrState()};let i=e.getCurrPksKey();r[i]=false;t=yunj.objSupp(t,r);let s={};a(l).trigger(`yunj_table_${e.id}_get_request_filter_data`,[s,t]);return t.convert?JSON.stringify(s):s}getCurrBuildTable(){return this.isSetCols()?this.buildMap.table:null}getCurrLayTable(){let t=this.getCurrBuildTable();return t?t.layTable:null}}a(l).ready(function(){i.yunj.table={};let t=a("table[type=yunj]");if(yunj.isUndefined(YUNJ_TABLE)||!yunj.isObj(YUNJ_TABLE)||t.length<=0)return;i.YunjTable=r;t.each(function(){let t=a(this).attr("id");if(!YUNJ_TABLE.hasOwnProperty(t))return true;let e=YUNJ_TABLE[t];i.yunj.table[t]=new r({id:t,elem:a(this),args:e})})})});