layui.define(["TableColTemplet","jquery","yunj"],function(e){let t=layui.TableColTemplet;let l=window;let a=document;let n=layui.jquery;class i extends t{constructor(e){super(e);this.tableSortable=null;this.tableSortableBoxFlag=null}async renderBefore(){let e=this;e.tableSortableBoxFlag=`div[lay-table-id=yunj_table_${e.tableId}] .layui-table-box .layui-table-main tbody`;await yunj.includeJs("/static/yunj/libs/Sortable/Sortable.min.js");return"done"}layout(){let e=this;let t=e.table.getCurrPk();let l=yunj.iconClass(e.args.iconClass);return`{{#  
                        let val = d.${e.key};
                        let content = "";
                        if(yunj.isUndefined(val)){
                            content = "<i class='${l}'></i>";
                        }else{
                            content = "<div class='content' title='"+val+"'><i class='${l}'></i>"+val+"</div>";
                        }
                     }}
                    <div class="yunj-table-drag-sort-item" data-${t}="{{ d.${t} }}" title="拖拽排序">{{- content }}</div>`}defineExtraEventBind(){let t=this;let e=`yunj_table_${t.tableId}_render_table_done_event_bind_row_drag_sort`;if(yunj.isUndefined(l[e])){l[e]=true;n(a).bind(`yunj_table_${t.tableId}_render_table_done`,function(){let e={handle:`.yunj-table-drag-sort-item`,animation:150,ghostClass:"yunj-table-drag-sort-item-checked",onUpdate:function(e){t.tableSortExec(e)}};t.tableSortable=new Sortable(a.querySelector(t.tableSortableBoxFlag),e)})}if(yunj.isUndefined(l.TABLE_ROW_DRAG_SORT_CLICK_COPY_EVENT_BIND)){l.TABLE_ROW_DRAG_SORT_CLICK_COPY_EVENT_BIND=true;n(a).on("click",".yunj-table-drag-sort-item .content",function(e){yunj.copy(n(this).attr("title"));e.stopPropagation()})}}tableSortExec(i){let o=this;let e={title:"排序",event:"sort"};let t=o.table.getCurrPk();let l=o.table.getCurrPksKey();e[l]=[];n(`${o.tableSortableBoxFlag} td[data-field=${o.key}] .yunj-table-drag-sort-item`).each(function(){e[l].push(n(this).data(t))});o.tableSortable.option("disabled",true);o.table.buildMap.table.asyncEventRequest(e).then(()=>{o.tableSortable.option("disabled",false)}).catch(e=>{yunj.error(e);o.tableSortable.option("disabled",false);let t=i.oldIndex;let l=i.newIndex;let a=i.item.tagName;let n=i.from.getElementsByTagName(a);if(t>l){i.from.insertBefore(i.item,n[t+1])}else{i.from.insertBefore(i.item,n[t])}})}}e("TableColDragSort",i)});