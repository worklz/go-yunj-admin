layui.define(["jquery","yunj","TableBuild","button","validate"],function(e){let t=window;let l=document;let o=layui.jquery;let r=layui.TableBuild;let i=layui.button;let n=layui.validate;class a extends r{constructor(e){super(e,"filter");this.fieldObjs={};this.currFormEl=null}async render(e=""){let t=this;t._renderBefore();await t._renderFields();let r=t.buildBoxEl.find(".filter-form");if(r.length<=0)return;r.removeClass("filter-form-this");let l=t.buildBoxEl.find(`.filter-form[lay-filter=${t.getCurrFormId()}]`);if(l.length<=0)return;l.addClass("filter-form-this");t.currFormEl=l;t._setCurrFormLayout();t._renderAfter()}async _renderFields(){let r=this;if(r.buildBoxEl.find(".filter-form").length>0)return;let l=r.buildArgs;if(r.isSetState()){for(let t in l){if(!l.hasOwnProperty(t)||yunj.isArray(l[t])&&l[t].length<=0)continue;let e=r.generateFormId(t);r.buildBoxEl.append(`<form class="layui-form layui-form-pane yunj-form filter-form" lay-filter="${e}"><div class="layui-row"></div></form>`);await r._renderFormFields(e,l[t])}}else{if(yunj.isArray(l)&&l.length<=0)return;let e=r.generateFormId();r.buildBoxEl.append(`<form class="layui-form layui-form-pane yunj-form filter-form" lay-filter="${e}"><div class="layui-row"></div></form>`);await r._renderFormFields(e,l)}}async _renderFormFields(l,r){let i=this;let o=[12,6,3,3,3];for(let t in r){if(!r.hasOwnProperty(t))continue;let e=r[t];if(!e.hasOwnProperty("grid")||!yunj.isPositiveIntArray(e.grid)){e.grid=o}await new Promise(r=>{yunj.formField(e.type,{formId:l,key:t,args:e}).then(t=>{t.render(`.filter-form[lay-filter=${l}] > .layui-row`,"").then(e=>{i.fieldObjs[t.id]=t;r()})})})}let e=yunj.generateGridClass(o);let t=`<div class="${e}"><div class="layui-form-item yunj-form-item"><div class="actions-box"></div></div></div>`;i.buildBoxEl.find(`.filter-form[lay-filter=${l}] > .layui-row`).append(t)}_setCurrFormLayout(){let e=this;if(!e.currFormEl)return;let t=e.currFormEl;e._setCurrFormLabelLayout();e._setCurrFormButtonLayout();if(t.find(".layui-row > div").length<=2)return;let r=t.find(".layui-row > div:not(:first,:last)");if(l.body.offsetWidth>768){r.show("fast");t.removeClass("filter-form-stow").addClass("filter-form-unfold")}else{r.hide("fast");t.removeClass("filter-form-stow").addClass("filter-form-unfold")}}_setCurrFormLabelLayout(){let e=this;let t=0;let r=e.currFormEl.find(".yunj-form-item:not(.yunj-form-item-label-width-fill,:has(.yunj-form-item-label-width-fill))");r.find(".layui-form-label").css("width","auto");r.each(function(){let e=o(this).find(".layui-form-label").outerWidth();if(e>t)t=e});r.find(".layui-form-label").css("width",t+2+"px")}_setCurrFormButtonLayout(){let e=this;let t=e.currFormEl.find(".yunj-form-item:last .actions-box");if(t.html().length>0)return;let r=e.getCurrFormId();let l=`.filter-form[lay-filter=${r}] .yunj-form-item:last .actions-box`;i("search",r).render(l);i("reset",r).render(l);t.append(`<button type="button" class="layui-btn layui-btn-sm layui-btn-primary layui-icon filter-form-layout-control"></button>`)}_renderBefore(){}_renderAfter(){let i=this;let e=`YUNJ_TABLE_${i.tableId}_GET_REQUEST_FILTER_DATA_EVENT_BIND_BY_FILTER`;if(yunj.isUndefined(t[e])){t[e]=true;o(l).bind(`yunj_table_${i.tableId}_get_request_filter_data`,function(e,t,r){if(!r.filter)return;let l=yunj.formData(i.generateFormId(r.state?r.state:false),n);Object.assign(t,l)})}}setEventBind(){let t=this;o(l).bind(`yunj_table_${t.tableId}_doc_width_change`,function(e){t._setCurrFormLayout()});t.buildBoxEl.on("click",".filter-form-layout-control",function(){console.log(123123);let e=t.currFormEl.hasClass("filter-form-unfold");t.currFormEl.removeClass(`filter-form-${e?"unfold":"stow"}`).addClass(`filter-form-${e?"stow":"unfold"}`);t.currFormEl.find(".layui-row > div:not(:first,:last)").slideToggle("fast")});t.buildBoxEl.on("click",".yunj-btn-reset",function(){o(l).trigger(`yunj_form_${t.getCurrFormId()}_reset`);o(l).trigger(`yunj_table_${t.tableId}_filter_submit`)});t.buildBoxEl.on("click",".yunj-btn-search",function(){o(l).trigger(`yunj_table_${t.tableId}_filter_submit`)});t.buildBoxEl.on("keyup",function(e){if(e.keyCode===13){let e=t.buildBoxEl.find("input:focus");if(e.length>0){o(l).trigger(`yunj_table_${t.tableId}_filter_submit`)}}})}generateFormId(e=false){return this.tableId+(e!==false?`_${e}`:"")}getCurrFormId(){return this.tableId+(this.isSetState()?`_${this.getCurrState()}`:"")}}e("TableBuildFilter",a)});