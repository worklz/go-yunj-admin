layui.define(["jquery","yunj","element","TableBuild"],function(e){let l=window;let a=document;let i=layui.jquery;let t=layui.element;let n=layui.TableBuild;class u extends n{constructor(e){super(e,"state");this.value=null}async render(e=""){let a=this;let t=a.buildBoxEl.find("li").length<=0;if(t){a._renderBefore();let t=a.buildArgs;let l="";for(let e=0;e<t.length;e++){l+=`<li data-state="${t[e].key}">${t[e].title}(<span class="count">0</span>)</li>`}l=`<div class="layui-tab layui-tab-brief state-box" lay-filter="state_${a.tableId}"><ul class="layui-tab-title">${l}</ul></div>`;a.buildBoxEl.html(l);a.buildBoxEl.find(".layui-tab-title li:first").addClass("layui-this")}a.setValue();if(e!==YunjTable.RENDER_MODE.STATE_SWITCH){await a.renderCount()}if(t){a._renderAfter()}}setValue(){this.value=this.buildBoxEl.find(".layui-this").data("state")}getValue(){return this.value}renderCount(){let a=this;return new Promise((t,l)=>{let e={[yunj.config("builder.id_key")]:a.tableId,[yunj.config("builder.async_type_key")]:"stateCount"};yunj.request(a.table.url,e,"post").then(e=>{let l=e.data;if(!yunj.isEmptyObj(l)){for(let t in l){if(!l.hasOwnProperty(t))continue;let e=a.buildBoxEl.find(`.state-box li[data-state=${t}]`);if(e.length>0)e.find(".count").html(l[t])}}t()}).catch(e=>{yunj.error(e);l(e)})})}_renderBefore(){}_renderAfter(){let e=this;let t=`YUNJ_TABLE_${e.tableId}_GET_REQUEST_FILTER_DATA_EVENT_BIND_BY_STATE`;if(yunj.isUndefined(l[t])){l[t]=true;i(a).bind(`yunj_table_${e.tableId}_get_request_filter_data`,function(e,t,l){t.state=l.state})}}setEventBind(){let a=this;t.on(`tab(state_${a.tableId})`,function(e){let t=i(this).data("state");let l=a.getValue();if(t===l)return false;a.table.render(YunjTable.RENDER_MODE.STATE_SWITCH)})}}e("TableBuildState",u)});