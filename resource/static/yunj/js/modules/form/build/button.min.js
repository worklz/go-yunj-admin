layui.define(["jquery","yunj","FormBuild","button","validate"],function(e){let t=window;let n=document;let r=layui.jquery;let i=layui.FormBuild;let u=layui.button;let l=layui.validate;class o extends i{constructor(e){super(e,"button")}_initBuildBoxEl(){let e=this;let t=e.formBoxEl.find(".yunj-form-header .content");t.append(`<div class="btn-box"></div>`);e.buildBoxEl=t.find(".btn-box")}async render(){let r=this;let e=r.buildBoxEl.html();if(e.length>0)return;r.buildBoxEl.html("");let i="";let l=yunj.isMobile();let o=r.buildArgs;for(let n in o){if(!o.hasOwnProperty(n))continue;let e=o[n];e.formId=r.formId;let t="";if(l&&e.mobileDropDown){t=u(n,e).layout(true)}if(t){i+=t}else{u(n,e).render(`.yunj-form-box[lay-filter=${r.formId}] .yunj-form-header .btn-box`)}}if(i.length>0){await new Promise(e=>{layui.use("ydropdown",()=>{r.buildBoxEl.append(yunj.dropdown.layout(i));e()})})}}_submit(){let t=this;let e=yunj.formData(t.formId,l);if(yunj.isEmptyObj(e))return;let n={[yunj.config("builder.id_key")]:t.formId,[yunj.config("builder.async_type_key")]:"submit",data:JSON.stringify(e)};yunj.request({url:t.form.url,data:n,type:"post",loading:true}).then(e=>{if(yunj.isObj(e.data)&&e.data.hasOwnProperty("reload")&&e.data.reload){let t=yunj.rawPageWin();if(t){let e=yunj.rawTable();if(e){e.render()}else{t.location.reload(true)}}}if(t.form.isPopup)yunj.closeCurr()}).catch(e=>{yunj.error(e)})}setEventBind(){let t=this;r(n).bind(`yunj_form_${t.formId}_win_resize`,function(e){t.render()});if(t.buildArgs.hasOwnProperty("return")){t.buildBoxEl.on("click",".yunj-btn-return",function(){yunj.closeCurr()})}if(t.buildArgs.hasOwnProperty("reload")){t.buildBoxEl.on("click",".yunj-btn-reload",function(){location.reload(true)})}if(t.buildArgs.hasOwnProperty("reset")){t.buildBoxEl.on("click",".yunj-btn-reset",function(){r(n).trigger(`yunj_form_${t.formId}_reset`)})}if(t.buildArgs.hasOwnProperty("clear")){t.buildBoxEl.on("click",".yunj-btn-clear",function(){r(n).trigger(`yunj_form_${t.formId}_clear`)})}if(t.buildArgs.hasOwnProperty("submit")){t.buildBoxEl.on("click",".yunj-btn-submit",function(){t._submit()})}}}e("FormBuildButton",o)});