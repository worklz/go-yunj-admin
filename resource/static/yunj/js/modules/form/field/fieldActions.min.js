layui.define(["jquery","yunj","elemProgress"],function(e){let c=window;let i=document;let r=layui.jquery;let u=layui.elemProgress;class t{constructor(e,t={}){let l=e.fieldObj;this.fieldObj=l;this.fieldBoxEl=l.boxEl;this.fieldValueElSelector=e.fieldValueElSelector;this.fieldValueEl=e.fieldValueEl;this.actionsObj=e;this.actionsEl=e.actionsEl}}class s extends t{constructor(e,t={}){super(e,t);t=yunj.objSupp(t,{contentHtml:null,showAfter:null,hideAfter:null});this.contentHtml=t.contentHtml;this.showAfter=t.showAfter;this.hideAfter=t.hideAfter;this.selectIconEl=null;this.selectPopupEl=null;this.selectContentEl=null;this.selectParentEl=null;if(!this.fieldObj.args.readonly&&this.actionsEl.children(".select-icon").length<=0){this.init()}}init(){let e=this;e.initElement();e.setEventBind()}initElement(){let e=this;e.actionsEl.append(`<i class="action-item layui-icon layui-icon-triangle-d select-icon"></i>`);e.fieldValueEl.after(`<div class="select-popup"><div class="content"></div></div>`);e.selectIconEl=e.actionsEl.children(".select-icon");e.selectPopupEl=e.fieldValueEl.siblings(".select-popup");e.selectContentEl=e.selectPopupEl.children(".content");e.selectParentEl=e.selectPopupEl.parent()}setSelectPopupShowHide(e=null){let n=this;let t=n.selectIconEl;let s=n.selectPopupEl;let o=n.selectContentEl;let a=n.selectParentEl;if(e===null){e=!s.is(":visible")}if(e){r(".yunj-form-item .yunj-form-item-control .select-icon").removeClass("select-icon-up");r(".yunj-form-item .yunj-form-item-control .select-popup").hide();let l=a.offset().top-r(c).scrollTop();let i=r(c).height()-l-a.outerHeight();if(l>i){s.css({top:"auto",bottom:"42px","max-height":l-72+"px"})}else{s.css({top:"42px",bottom:"auto","max-height":i+"px"})}!t.hasClass("select-icon-up")&&t.addClass("select-icon-up");s.show();if(yunj.isFunction(n.contentHtml)){let t=u({elem:o});let e={selectContentEl:o,isUp:l>i};n.contentHtml(e).then(e=>{yunj.isString(e)&&o.html(e);t.reset_progress(100);n.showAfter&&n.showAfter()})}else{o.html(n.contentHtml);n.showAfter&&n.showAfter()}}else{t.removeClass("select-icon-up");s.hide();yunj.isFunction(n.hideAfter)&&n.hideAfter()}}setEventBind(){let t=this;r(i).bind(`yunj_form_${t.fieldObj.formId}_tab_change`,function(e){t.selectParentEl.css("position","relative");t.selectPopupEl.css("minWidth",t.selectParentEl.outerWidth()-2+"px")});t.fieldBoxEl.on("click",t.selectParentEl,function(e){if(!r(e.target).closest(".select-popup").length){t.setSelectPopupShowHide()}});r(i).on("click",function(e){if(!r(e.target).closest(t.selectParentEl).length){t.setSelectPopupShowHide(false)}})}}class o extends t{constructor(e,t={}){super(e,t);this.eyeEl=null;if(!this.fieldObj.args.readonly&&this.fieldValueEl.attr("type")==="password"&&this.actionsEl.children(".content-eye").length<=0){this.init()}}init(){let e=this;e.initElement();e.setEventBind()}initElement(){let e=this;e.actionsEl.append(`<i class="action-item layui-icon layui-icon-eye content-eye"></i>`);e.eyeEl=e.actionsEl.children(".content-eye")}setContentEyeShowHide(e){let t=this;if(!t.eyeEl)return;if(e){t.eyeEl.show()}else{t.eyeEl.hide()}}setInputType(){let e=this;if(e.fieldValueEl.attr("type")==="password"){e.fieldValueEl.attr("type","text");e.eyeEl.removeClass("layui-icon-eye-invisible").addClass("layui-icon-eye")}else{e.fieldValueEl.attr("type","password");e.eyeEl.removeClass("layui-icon-eye").addClass("layui-icon-eye-invisible")}}setEventBind(){let t=this;let e=t.fieldObj;t.fieldValueEl.on("input",function(){t.setContentEyeShowHide(!e.isEmptyValue())});t.eyeEl.on("click",function(e){t.setInputType();e.stopPropagation()})}}class a extends t{constructor(e,t={}){super(e,t);t=yunj.objSupp(t,{allowFocused:false});this.allowFocused=t.allowFocused||false;this.clearEl=null;this.isFocused=false;if(!this.fieldObj.args.readonly&&this.actionsEl.children(".content-clear").length<=0){this.init()}}init(){let e=this;e.initElement();e.setEventBind()}initElement(){let e=this;e.actionsEl.append(`<i class="action-item layui-icon layui-icon-clear content-clear"></i>`);e.clearEl=e.actionsEl.children(".content-clear")}setContentClearShow(e){let t=this;if(e){t.clearEl.show()}else{t.clearEl.hide()}}setEventBind(){let t=this;let l=t.fieldObj;t.fieldBoxEl.on("mouseenter",t.fieldValueElSelector,function(e){t.setContentClearShow(!l.isEmptyValue())});t.fieldBoxEl.on("mouseleave",t.fieldValueElSelector,function(e){t.setContentClearShow(t.isFocused&&!l.isEmptyValue())});t.fieldBoxEl.on("mouseenter",".content-clear",function(e){t.setContentClearShow(true)});if(t.allowFocused){t.fieldBoxEl.on("input",t.fieldValueElSelector,function(e){t.setContentClearShow(!l.isEmptyValue())});t.fieldBoxEl.on("focus",t.fieldValueElSelector,function(){t.isFocused=true;t.setContentClearShow(!l.isEmptyValue())});t.fieldBoxEl.on("blur",t.fieldValueElSelector,function(e){t.isFocused=false;t.setContentClearShow(false)})}t.clearEl.on("click",function(e){e.stopPropagation();l.setValue();t.setContentClearShow(false)})}}class h extends t{constructor(e,t={}){super(e,t);this.charNumEl=null;this.limitMaxCharNum=0;if(this.actionsEl.children(".char-num").length<=0){this.init()}}init(){let e=this;e.initElement();e.initLimitMaxCharNum();e.setEventBind()}initElement(){let e=this;e.actionsEl.append(`<span class="action-item char-num"></span>`);e.charNumEl=e.actionsEl.children(".char-num")}initLimitMaxCharNum(){let i=this;let e=i.fieldObj.args.verify;if(e&&e.indexOf("max:")!==-1){let l=e.split("|");for(let t=0;t<l.length;t++){let e=l[t];if(e.indexOf("max:")===0){i.limitMaxCharNum=parseInt(e.replace("max:",""));break}}}}setCurrCharNum(){let e=this;let t=e.fieldObj.getValue().length;let l=t;let i="#d2d2d2";if(e.limitMaxCharNum>0){l=`${t}/${e.limitMaxCharNum}`;if(t>e.limitMaxCharNum){i="#ff5722"}}e.charNumEl.html(l).css("color",i).show();e.actionsEl.show()}setEventBind(){let t=this;t.fieldValueEl.on("input",function(e){t.setCurrCharNum()})}}class l{constructor(e={}){e=yunj.objSupp(e,{fieldObj:null,fieldValueElSelector:null,fieldValueElNoAutoIndent:false,actions:{}});let{fieldObj:t,fieldValueElSelector:l,fieldValueElNoAutoIndent:i}=e;let n=t.boxEl.find(l);this.args=e;this.fieldObj=t;this.fieldValueElSelector=l;this.fieldValueElNoAutoIndent=i;this.fieldValueEl=n;this.actions={};this.actionsEl=null;this.isCanSetAction=false;this.ACTION_CLASS={charNum:h,contentClear:a,contentEye:o,selectPopup:s};if(yunj.isJQueryEl(n)&&n.length>0&&n.siblings(".field-actions").length<=0){this.init()}}init(){let e=this;e.initAttr();e.setEventBind();e.setConfigActions()}initAttr(){let e=this;let l={};Object.entries(e.args.actions).forEach(([e,t])=>{l[e]={args:yunj.isObj(t)?t:{}}});e.actions=l;e.fieldValueEl.after(`<div class="field-actions"></div>`);e.actionsEl=e.fieldValueEl.siblings(".field-actions");e.fieldValueEl.parent().css("position","relative")}setFieldValueElStyle(){let e=this;let t="10px";let l=e.actionsEl.width();if(l>10&&!e.fieldValueElNoAutoIndent){t=Math.ceil(l)+1+"px"}e.fieldValueEl.css("padding-right",t)}setConfigActions(){let t=this;t.isCanSetAction=true;let l=t.actions;for(let e in l){if(!l.hasOwnProperty(e)){continue}t.setAction(e,l[e].args)}}setAction(e,t={}){let l=this;if(!l.isCanSetAction){return l}if(!(l.ACTION_CLASS[e]||null)){throw new Error(`FormFieldActions未找到${e}操作类`)}t=t||{};l.actions[e].obj=new l.ACTION_CLASS[e](l,t);return l}getActionObj(e){let t=this;if(!t.actions.hasOwnProperty(e)||!(t.actions[e].obj||null)){return null}return t.actions[e].obj}setEventBind(){let l=this;r(i).bind(`yunj_form_${l.fieldObj.formId}_tab_change`,function(e){l.setFieldValueElStyle()});let e=new MutationObserver(function(e,t){l.setFieldValueElStyle()});e.observe(l.actionsEl[0],{childList:true,attributes:true,characterData:true,subtree:true,attributeOldValue:true,characterDataOldValue:true})}}e("FormFieldActions",l)});