layui.define(["FormField","yunj","jquery","form"],function(t){let e=layui.FormField;let r=layui.jquery;let i=layui.form;class l extends e{constructor(t={}){super(t);this.options=null;this.acc="district";this.province_el=null;this.city_el=null;this.district_el=null;this.last_value=null}defineExtraArgs(){let t=this;return{acc:"district"}}handleArgs(t){if(t.verify.indexOf("area")===-1)t.verify+=(t.verify?"|":"")+`area:${t.acc}`;return t}defineBoxHtml(){let t=this;return`<div class="layui-form-item yunj-form-item yunj-form-area" id="${t.id}">__layout__</div>`}async renderBefore(){let i=this;await new Promise(e=>{yunj.area_options().then(t=>{i.options=t;e("done")})});i.acc=i.args.acc;return"done"}layoutControl(){let t=this;let e=`<select name="${t.id}_province" data-type="province" lay-filter="${t.id}_province" ${t.args.readonly?"disabled":"lay-search"}></select>`;e=t.layout_control_acc(e);return`<div class="layui-input-inline yunj-form-item-control">${e}</div>`}layout_control_acc(t){let e=this;if(e.acc==="province")return t;t+=`<select name="${e.id}_city" data-type="city" lay-filter="${e.id}_city" ${e.args.readonly?"disabled":"lay-search"}></select>`;if(e.acc==="city")return t;t+=`<select name="${e.id}_district" data-type="district" lay-filter="${e.id}_district" ${e.args.readonly?"disabled":"lay-search"}></select>`;return t}renderDone(){let t=this;t.province_el=t.boxEl.find(`select[name=${t.id}_province]`);if(t.acc==="province")return true;t.city_el=t.boxEl.find(`select[name=${t.id}_city]`);if(t.acc==="city")return true;t.district_el=t.boxEl.find(`select[name=${t.id}_district]`)}setValue(t=""){let e=this;if(yunj.isString(t))t=yunj.isJson(t)?JSON.parse(t):{province:"",city:"",district:""};if(!yunj.isObj(t)||yunj.isEmptyObj(t)||!t.hasOwnProperty("province")||e.args.acc==="city"&&!t.hasOwnProperty("city")||e.args.acc==="district"&&(!t.hasOwnProperty("city")||!t.hasOwnProperty("district")))t={province:"",city:"",district:""};e.set_value_province(t);if(e.args.acc==="province"){i.render("select",e.tabFormFilter);e.last_value=t;return true}e.set_value_city(t);if(e.args.acc==="city"){i.render("select",e.tabFormFilter);e.last_value=t;return true}e.set_value_district(t);i.render("select",e.tabFormFilter);e.last_value=t}set_value_province(e){let t=this;if(t.boxEl.find(`select[name=${t.id}_province] option`).length>0){t.province_el.find("option").prop("selected",false);if(e.province.toString().length>0)t.province_el.find(`option[value=${e.province}]`).prop("selected",true);return true}let i=t.options[0];let r='<option value="">请选择</option>';for(let t in i){if(!i.hasOwnProperty(t))continue;r+=`<option value="${t}" ${e.hasOwnProperty("province")&&t===e.province?"selected":""}>${i[t]}</option>`}t.province_el.html(r)}set_value_city(e){let t=this;if(e.province.toString().length<=0){t.city_el.html('<option value="">请选择</option>');t.city_el.attr("disabled",true);t.city_el.removeAttr("lay-search");return true}if(!t.args.readonly){t.city_el.attr("disabled",false);t.city_el.attr("lay-search",true)}let i=t.options[`0,${e.province}`];let r=Object.keys(i)[0];if(t.city_el.find(`option[value=${r}]`).length>0){t.city_el.find("option").prop("selected",false);if(e.city.toString().length>0)t.city_el.find(`option[value=${e.city}]`).prop("selected",true);return true}let l="";for(let t in i){if(!i.hasOwnProperty(t))continue;l+=`<option value="${t}" ${e.hasOwnProperty("city")&&t===e.city?"selected":""}>${i[t]}</option>`}t.city_el.html(l)}set_value_district(e){let t=this;if(e.city.toString().length<=0){t.district_el.html('<option value="">请选择</option>');t.district_el.attr("disabled",true);t.district_el.removeAttr("lay-search");return true}if(!t.args.readonly){t.district_el.attr("disabled",false);t.district_el.attr("lay-search",true)}let i=t.options[`0,${e.province},${e.city}`];let r=Object.keys(i)[0];if(t.district_el.find(`option[value=${r}]`).length>0){t.district_el.find("option").prop("selected",false);if(e.district.toString().length>0)t.district_el.find(`option[value=${e.district}]`).prop("selected",true);return true}let l="";for(let t in i){if(!i.hasOwnProperty(t))continue;l+=`<option value="${t}" ${e.hasOwnProperty("district")&&t===e.district?"selected":""}>${i[t]}</option>`}t.district_el.html(l)}getValue(){let t=this;let e=t.province_el.val();if(e.toString().length<=0)return"";let i={};t.boxEl.find("select").each(function(){i[r(this).data("type")]=r(this).val()});return yunj.isEmptyObj(i)?"":i}defineExtraEventBind(){let r=this;i.on(`select(${r.id}_province)`,function(t){let e=r.province_el.val();if(e===r.last_value.province)return true;let i={province:e};if(r.acc==="province"){r.setValue(i);return true}i.city=e.toString().length>0?Object.keys(r.options[`0,${e}`])[0]:"";if(r.acc==="city"){r.setValue(i);return true}i.district=i.city.toString().length>0?Object.keys(r.options[`0,${e},${i.city}`])[0]:"";r.setValue(i)});i.on(`select(${r.id}_city)`,function(t){let e=r.city_el.val();if(e===r.last_value.city)return true;let i={province:r.province_el.val(),city:e};if(r.acc==="city"){r.setValue(i);return true}i.district=Object.keys(r.options[`0,${i.province},${e}`])[0];r.setValue(i)});i.on(`select(${r.id}_district)`,function(t){let e=r.district_el.val();if(e===r.last_value.district)return true;let i=r.getValue();r.setValue(i)})}}t("FormFieldArea",l)});