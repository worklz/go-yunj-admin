layui.define(["FormField","FormFieldActions","yunj","jquery"],function(e){let t=window;let l=document;let i=layui.jquery;let n=layui.FormField;let o=layui.FormFieldActions;class s extends n{constructor(e={}){super(e);this.options=null;this.contentEl=null;this.iconBoxEl=null;this.iconPreviewEl=null;this.selectPopupContentEl=null}defineExtraArgs(){let e=this;return{placeholder:"图标class类名"}}async renderBefore(){let l=this;await new Promise(t=>{yunj.icon_options().then(e=>{l.options=e;t("done")})});return"done"}layoutControl(){let e=this;return`<div class="layui-input-inline yunj-form-item-control">
                        <div class="icon-box">
                            <input type="text" name="${e.id}" ${e.args.readonly?"readonly":""}
                                placeholder="${e.args.placeholder}" value="" autocomplete="off" class="layui-input icon-input">
                        </div>
                        <div class="icon-preview"></div>
                    </div>`}renderDone(){let e=this;e.contentEl=e.boxEl.find(`input[name=${e.id}]`);e.iconBoxEl=e.boxEl.find(".icon-box");e.iconPreviewEl=e.boxEl.find(".icon-preview");e.fieldActions=new o({fieldObj:e,fieldValueElSelector:`input[name=${e.id}]`,actions:{contentClear:null,selectPopup:{contentHtml:e.getSelectPopupContentHtml,showAfter:e.renderSelectItems}}});e.selectPopupContentEl=e.fieldActions.getActionObj("selectPopup").selectContentEl}setValue(e=""){let t=this;t.contentEl.val(e);t.setPreviewIconClass()}getValue(){let e=this;return e.contentEl.val()}setPreviewIconClass(){let e=this;let t=e.getValue();let l=yunj.iconClass(t||"");e.iconPreviewEl.html(`<i class="${l}" title="${l}"></i>`)}getSelectPopupContentHtml=e=>{let t=this;let{isUp:o}=e;return new Promise((e,t)=>{let l=`<div class="input-box"><input type="text" placeholder="关键词" class="layui-input keyowrds-input"></div>`;let i=`<div class="result-box"></div>`;let n="";if(o){n=i+l}else{n=l+i}e(n)})};renderSelectItems=()=>{let e=this;let t=e.selectPopupContentEl.find(".keyowrds-input").val();let l=JSON.parse(JSON.stringify(e.options));if(t){let o=new RegExp(t,"i");l.forEach(l=>{let i=0;let n=[];for(let t=0;t<l.icon.length;t++){if(i>=20){break}let e=l.icon[t];if(e.name&&e.name.search(o)!==-1||e.class&&e.class.search(o)!==-1){n.push(e);i++}}l.icon=n})}let i="";l.forEach(e=>{let l="";if(e.icon.length>0){e.icon.forEach(e=>{let t=yunj.iconClass(e.class);l+=`<li title="${t}">
                                            <i class="${t}"></i>
                                            <div class="icon-name">${e.name}</div>
                                        </li>`})}else{l="暂无匹配值..."}i+=`<div class="result-item">
                                    <div class="title">${e.title}：</div>
                                    <ul class="content">${l}</ul>
                                </div>`});e.selectPopupContentEl.find(".result-box").html(i)};defineExtraEventBind(){let l=this;l.boxEl.on("input",`input[name=${l.id}]`,function(e){l.setPreviewIconClass()});l.boxEl.on("keyup",".keyowrds-input",function(e){l.renderSelectItems()});l.boxEl.on("click",".result-box li",function(e){let t=i(this).attr("title");l.setValue(t);e.stopPropagation()});l.boxEl.on("click",".icon-preview i",function(e){e.stopPropagation();let t=i(this).attr("class");t&&yunj.copy(t)})}}e("FormFieldIcon",s)});